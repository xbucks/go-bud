package command

{{- if $.Imports }}

import (
	{{- range $import := $.Imports }}
	{{$import.Name}} "{{$import.Path}}"
	{{- end }}
)
{{- end }}

// Load the App
func Load(_ *gomod.Module, processes *Processes) *App {
	return &App{processes}
}

type Processes struct {
}

type App struct {
	processes *Processes
}

{{- define "process" }}
{{- range $flag := $.Flags }}
cmd.Flag(`{{ $flag.Slug }}`, `{{ $flag.Help }}`).{{ $flag.Method }}(&a.processes.{{ $.Full.Pascal }}Command.{{ $flag.Pascal }}){{ if $flag.Default }}.Default({{ $flag.Default }}){{ end }}
{{- end }}
{{- range $arg := $.Args }}
cmd.Arg(`{{ $arg.Slug }}`, `{{ $arg.Help }}`).{{ $arg.Method }}(&a.processes.{{ $.Full.Pascal }}Command.{{ $arg.Pascal }}){{ if $arg.Default }}.Default({{ $arg.Default }}){{ end }}
{{- end }}
{{- if $.Runnable }}
cmd.Run(a.processes.{{ $.Full.Pascal }}Command.Run)
{{ end }}
{{- range $sub := $.Subs }}

{ // $ {{ $.Name }} {{ $sub.Name }}
	cmd := cmd.Command(`{{ $sub.Name }}`, `{{ $sub.Help}}`)
	{{- template "process" $sub }}
}
{{- end }}
{{- end }}

func (a *App) Parse(ctx context.Context, args ...string) error {
	// $ bud run/build
	cmd := commander.New(`{{ $.Process.Slug }}`)
	{{- template "process" $.Process }}

	return cmd.Parse(ctx, args)
}
